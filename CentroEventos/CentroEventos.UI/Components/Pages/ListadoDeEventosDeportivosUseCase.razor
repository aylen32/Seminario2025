@using CentroEventos.UI.Components
@page "/ListadoEventosDeportivos"
@rendermode InteractiveServer
@inject ListadoEventoDeportivoUseCase ListadoEventoDeportivoUseCase
@inject BajaEventoDeportivoUseCase BajaEventoDeportivoUseCase
@inject NavigationManager Navegador

<DialogoConfirmacion @ref="dialogo" OnConfirmado="Eliminar"/>

<table class="table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nombre</th>
      <th>Descripcion</th> 
      <th>Fecha y Hora de inicio</th>
      <th>Duracion en horas</th>
      <th>Cupo maximo de personas</th>
      <th>Id de responsable</th>
    </tr>
  </thead>
  <tbody>
    @foreach (var even in _lista)
    {
    <tr>
      <td>@even.Id</td>
      <td>@even.Nombre</td>
      <td>@even.Descripcion</td>
      <td>@even.FechaHoraInicio</td>
      <td>@even.DuracionHoras</td>
      <td>@even.CupoMaximo</td>
      <td>@even.ResponsableId</td>
      <td>
        <button class="btn btn-primary" @onclick="()=>ModificarEventoDeportivo(even)">
          Editar
        </button>
        <button class="btn btn-danger" @onclick="()=>ConfirmarEliminacion(even)">
          Eliminar
        </button>
      </td>
    </tr>
    }
  </tbody>
</table>

@code {
    List<EventoDeportivo> _lista = new List<EventoDeportivo>();
    protected override void OnInitialized()
    {
       _lista = ListadoEventoDeportivoUseCase.Ejecutar();
    }

    DialogoConfirmacion dialogo = null!;
    EventoDeportivo? _EventoParaEliminar = null;

   private void ConfirmarEliminacion(EventoDeportivo even)
   {
      _EventoParaEliminar = even;
      dialogo.Mostrar($"¿Desea eliminar el evento {even.Nombre}, a cago del responsable con Id: {even.ResponsableId}?");
   }

   private void Eliminar()
   {
     if (_EventoParaEliminar != null)
     {
       BajaEventoDeportivoUseCase.Ejecutar(_EventoParaEliminar.Id, 1);
      _lista = ListadoEventoDeportivoUseCase.Ejecutar(); 
     }
   }

   void ModificarEventoDeportivo(EventoDeportivo even)
   {
     Navegador.NavigateTo($"AgregarEventoDeportivo/{even.Id}");
   }
}